{% assign urlArray = page.url | replace: '/', ' ' | split: " " %}
{% assign activePlatform = urlArray[0] %}
{% assign platform = site.data.routes.platforms | where: "href", activePlatform | first %}
{% assign activeHub = urlArray[2] %}
{% assign hub = platform.hubs | where: "href", activeHub | first %}
{% assign activeSection = urlArray[3] | remove: ".html" %}
{% assign section = hub.sections | where: "href", activeSection | first %}

<ul class="lhn-items">
    <li class="home-link">
        {% if page.url == "/" %}
            <div class="selected">Home</div>
        {% else %}
            <a href="/" class="link">Home</a>
        {% endif %}
    </li>
    {% for platform in site.data.routes.platforms %}
        <li>
            <a href="/{{ platform.href }}/hubs" class="icon-with-link {% if platform.href == activePlatform %}selected{% else %}link{% endif %}">
                <img src="/assets/images/{% if platform.href == activePlatform %}down{% else %}arrow-right{% endif %}.svg" class="base-icon">
                <span>{{ platform.title }}</span>
            </a>
            {% if platform.href == activePlatform %}
                <ul>
                    {% for hub in platform.hubs %}
                        <li>
                            <a href="/{{ activePlatform }}/hubs/{{ hub.href }}" class="icon-with-link {% if hub.href == activeHub %}selected{% else %}link{% endif %}">
                                <img src="/assets/images/{% if hub.href == activeHub %}down{% else %}arrow-right{% endif %}.svg" class="base-icon">
                                <span>{{ hub.title }}</span>
                            </a>
                            {% if hub.href == activeHub %}
                                <ul class="nested-treeview">
                                    {% for section in hub.sections %}
                                        <li>
                                            <a href="/{{ activePlatform }}/hubs/{{ hub.href }}/{{ section.href }}" class="icon-with-link {% if section.href == activeSection %}selected{% else %}link{% endif %}">
                                                <img src="/assets/images/{% if section.href == activeSection %}down{% else %}arrow-right{% endif %}.svg" class="base-icon">
                                                <span>{{ section.title }}</span>
                                            </a>
                                            {% if section.href == activeSection %}
                                                <ul>
                                                    {% for article in section.articles %}
                                                        {% assign article_href = section.href | append: '/' | append: article.href %}
                                                        {% include lhn-article-link.html platform=activePlatform hub=hub.href href=article_href title=article.title %}
                                                    {% endfor %}
                                                </ul>
                                            {% endif %}
                                        </li>
                                    {% endfor %}
                                    {% for article in hub.articles %}
                                        {% include lhn-article-link.html platform=activePlatform hub=hub.href href=article.href title=article.title %}
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
        </li>
    {% endfor %}
</ul>
