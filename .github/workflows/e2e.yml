name: E2E iOS Tests

# Only lint on branches that aren't related to master and the deploy process
on:
    push:
        branches-ignore:
            - 'master'
            - 'version-bump-*'
        tags-ignore:
            - '*'

jobs:
    test:
        runs-on: macos-latest
        steps:
          - uses: actions/checkout@v2
          - uses: actions/setup-ruby@v1

          - name: Install bundler
            run: gem install bundler

          - name: Install gems
            run: bundle install

          - name: Install node packages
            run: npm install

          - name: Install detox
            run: npm install -g detox-cli

          - name: Install cocoapods
            run: cd ios && pod install

          - name: Install brew depdencies
            run: |
              brew tap wix/brew
              brew install applesimutils

          - name: Build tests
            run: detox build

          - name: Run tests
            run: detox test --loglevel trace --cleanup
