name: eslint

# Only lint on branches that aren't related to master and the deploy process
on:
    push:
        branches-ignore:
            - 'master'
            - 'version-bump-*'
        tags-ignore:
            - '*'

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js
              uses: actions/setup-node@v1
            - run: npm install
            - run: npm run lint
              env:
                  CI: true
            - name: Job failed Slack notification
              uses: rtCamp/action-slack-notify@master
              env:
                  SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
                  SLACK_CHANNEL: "#andrew-test"
                  SLACK_USERNAME: "Botify"
                  SLACK_ICON: "https://s3-us-west-2.amazonaws.com/slack-files2/avatars/2017-07-19/214290201728_e3b6a20b1b2cb3145d6f_72.png"
                  SLACK_COLOR: "#DB4545"
                  SLACK_TITLE: ðŸ’¥ ${{ github.repository }} failed on ${{ github.workflow }} workflow ðŸ’¥
                  SLACK_MESSAGE: "_Someone should look into this_"

            - uses: 8398a7/action-slack@v3
              with:
                   status: custom
                   fields: workflow,job,commit,repo,ref,author,took
                   custom_payload: |
                    {
                      username: 'Botify',
                      channel: '#andrew-test',
                      attachments: [{
                        color: "#DB4545",
                        pretext: `${github.repository} failed on ${github.workflow} workflow ðŸ’¥`,
                        text: `${process.env.AS_WORKFLOW}\n${process.env.AS_JOB} (${process.env.AS_COMMIT}) of ${process.env.AS_REPO}@${process.env.AS_REF} by ${process.env.AS_AUTHOR} succeeded in ${process.env.AS_TOOK}`,
                      }]
                    }
              env:
                   GITHUB_TOKEN: ${{ github.token }}
                   SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
